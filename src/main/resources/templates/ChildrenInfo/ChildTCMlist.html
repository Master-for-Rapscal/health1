<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--引入抬头页面-->
<div th:replace="common/header :: header"  ></div>

<div class="easyui-layout" data-options="fit:true">
    <!-- Begin of toolbar -->
    <div id="wu-toolbar">
        <div class="wu-toolbar-button">
            <!--引入菜单页面-->
            <div th:replace="common/menus :: menus"  > </div>
        </div>

        <!--条件搜索-->
        <div class="wu-toolbar-search">
            <label>用户名:</label><input id="search-name" class="wu-text" style="width:100px">
            <a href="#" id="search-btn" class="easyui-linkbutton" iconCls="icon-search">搜索</a>
        </div>

    </div>
    <!-- End of toolbar 数据table表格 -->
    <table id="data-datagrid" class="easyui-datagrid" toolbar="#wu-toolbar"></table>

</div>

<div id="CR" style="width: 1000px;height: 500px"></div>


<div id="TCM" style="width: 900px;height:500px">
    <table border="1" style="border-collapse: collapse">
        <thead>姓名 <input type="text" style="border:none;outline:medium" id="Tname"/>编号<input type="text" style="border:none;outline:medium" id="Tnum"/></thead>
        <tr><td>月龄 *</td><td colspan="2"><input type="text" style="border:none;outline:medium" id="Tmonth"/></td></tr>
        <tr><td>随访日期 *</td><td colspan="2"><input type="text" style="border:none;outline:medium" id="TFdate"/></td></tr>
        <tr><td height="301">中医药健康服务</td><td width="700">
            <p>
                <input type="checkbox"/>
                1中医药饮食调养指导
                <input type="checkbox"/>
                2中医起居调摄指导
                <input type="checkbox"/>
                3传授摩腹、捏脊方法
            </p>
            <p>
                <input type="checkbox"/>
                4其他：
            </p></td><td width="59"></td></tr>
        <tr><td>下次随访日期</td><td colspan="2"><input type="text" id="Tnf" style="border:none;outline:medium"></td></tr>
        <tr><td>随访医生签名*</td><td colspan="2"><input type="text" id="Tfd" style="border:none;outline:medium"></td></tr>
    </table>
</div>


<div id="process-dialog" class="easyui-dialog" data-options="closed:true,iconCls:'icon-upload',title:'正在上传图片'" style="width:450px; padding:10px;">
    <div id="p" class="easyui-progressbar" style="width:400px;" data-options="text:'正在上传中...'"></div>
</div>
<input type="file" id="photo-file" style="display:none;" onchange="upload()">
<!--引入叫本页面<%@include file="../common/footer.jsp"%>-->
<div th:replace="common/footer :: myfooter"  ></div>


<!-- End of easyui-dialog -->
<script type="text/javascript" th:inline="none">


   /*
     * 删除记录
     */
    function remove(){
        $.messager.confirm('信息提示','确定要删除该记录？', function(result){
            if(result){
                var item = $('#data-datagrid').datagrid('getSelections');
                if(item == null || item.length == 0){
                    $.messager.alert('信息提示','请选择要删除的数据！','info');
                    return;
                }
                var ids = '';
                for(var i=0;i<item.length;i++){
                    ids += item[i].USER_ID + ',';
                }
                $.ajax({
                    url:'delete',
                    dataType:'json',
                    type:'post',
                    data:{ids:ids},
                    success:function(data){
                        if(data.type == 'success'){
                            $.messager.alert('信息提示','删除成功！','info');
                            $('#data-datagrid').datagrid('reload');
                        }else{
                            $.messager.alert('信息提示',data.msg,'warning');
                        }
                    }
                });
            }
        });
    }



    /**
     * 载入数据
     */
    $('#data-datagrid').datagrid({
        url:'list',
        rownumbers:true,
        singleSelect:false,
        pageSize:20,
        pagination:true,
        multiSort:true,
        fitColumns:true,
        idField:'id',
        treeField:'name',
        fit:true,
        onDblClickRow:function(rowIndex,row){
            $("#Tname").val(row.recordName);
            $.post("../ChildTCMRecord/list",function(data,status){
                var d="";
                for(var i =0;i<data.rows.length;i++) {

                    d+="<div onclick='openInfo("+data.rows[i].chmedmrerecordId+","+data.rows[i].chmedmreMonths+","+data.rows[i].chmedmreFollowdate+","+data.rows[i].chmedmreChmed+","+data.rows[i].chmedmreNextfollow+","+data.rows[i].chmedmreDoc+")'>";
                    d+="<div><span>随访日期</span><span>"+data.rows[i].chmedmreFollowdate+"</span></div>";
                    d+="<div><span>下次随访</span><span>"+data.rows[i].chmedmreNextfollow+"</span></div>";
                    d+="<div><span>随访医生</span><span>"+data.rows[i].chmedmreDoc+"</span></div>";
                    d+="</div>";
                }
                $("#CR").html(d)
            });
            $("#CR").dialog(function(){

            })
        },
        columns:[[
            { field:'userId',checkbox:true},
            { field:'recordInputtingcard',title:'健康档案号',width:100},
            /*  { field:'USER_NUMBER',title:'编号',width:100,align:'center'},*/
            { field:'recordName',title:'姓名',width:100,align:'center'},
            { field:'userSex',title:'性别',width:100,sortable:true},
            { field:'userBirthday',title:'出生日期',width:100},
            { field:'recordAdress',title:'联系地址',width:100},
            { field:'userMyphone',title:'联系电话',width:100,sortable:true},

            { field:'RECORD_People',title:'录入人',width:100},

            { field:'recordData',title:'建档日期',width:100,sortable:true},
            { field:'userState',title:'结案状态',width:100,sortable:true},
            { field:'cishu',title:'随访次数',width:100,align:'center'},
            { field:'userDe',title:'备注',width:100},
            { field:'USER_LINESTOCK',title:'下次检查时间',width:100,align:'center'}
        ]],
        onLoadSuccess:function(data){
            $('.authority-edit').linkbutton({text:'编辑权限',plain:true,iconCls:'icon-edit'});
        }
    });

    $('#data-datagrid1').datagrid({
        url:'../ChildTCMRecord/list',
        rownumbers:true,
        singleSelect:false,
        pageSize:20,
        pagination:true,
        multiSort:true,
        fitColumns:true,
        idField:'id',
        treeField:'name',
        fit:true,
        columns:[[
            { field:'chmedmreId',checkbox:true},
            { field:'chmedmreName',title:'姓名',width:100},
            { field:'chmedmrerecordId',title:'编号',width:100,align:'center'},
            { field:'chmedmreMonths',title:'月龄',width:100,sortable:true},
            { field:'chmedmreFollowdate',title:'随访日期',width:100},
            { field:'chmedmreChmed',title:'中医药健康服务',width:100},
            { field:'chmedmreNextfollow',title:'下次随访日期',width:100,sortable:true},
            { field:'chmedmreDoc',title:'随访医生',width:100}
        ]],
        onLoadSuccess:function(data){
            $('.authority-edit').linkbutton({text:'编辑权限',plain:true,iconCls:'icon-edit'});
        }
    });
   function openInfo(chmedmrerecordId,chmedmreMonths,chmedmreFollowdate,chmedmreChmed,chmedmreNextfollow,chmedmreDoc){
       alert('0000000');
     //
       $("#Tnum").val(chmedmrerecordId);
       $("#Tmonth").val(chmedmreMonths);
       $("#TFdate").val(chmedmreFollowdate);
    //s   $("#").val(chmedmreChmed);
       $("#Tnf").val(chmedmreNextfollow);
       $("#Tfd").val(chmedmreDoc);


       $("#TCM").dialog(function(){

       });
   }

</script>