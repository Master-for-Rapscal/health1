<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--引入抬头页面-->
<div th:replace="common/header :: header"></div>

<div class="easyui-layout" data-options="fit:true">
    <!-- Begin of toolbar -->
    <div id="wu-toolbar">
        <div class="wu-toolbar-button">
            <!--引入菜单页面-->
            <div th:replace="common/menus :: menus"></div>
        </div>
        <div class="wu-toolbar-search">
            <label>专题名称:</label><input id="search-caahepTopic" class="wu-text" style="width:100px">
            <label>健教形式:</label><input id="search-caahepHealtype" class="wu-text" style="width:100px">
            <a href="#" id="search-btn" class="easyui-linkbutton" iconCls="icon-search">搜索</a>
        </div>
    </div>
    <!-- End of toolbar -->
    <table id="data-datagrid" class="easyui-datagrid" toolbar="#wu-toolbar"></table>
</div>
<!-- Begin of easyui-dialog -->
<div id="add-dialog" class="easyui-dialog" data-options="closed:true,iconCls:'icon-save'"
     style="width:700px; padding:0px;">
    <form id="add-form" method="post">
        <input type="hidden" id="caahepId" name="caahepId" value="">
        <input type="hidden" name="caahepState" value="1">
   <table class="zuo-table-head" border="1" >
    <tr>
        <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="专题名称:" ></input></td>
        <td colspan="3"><input class="tdText_h easyui-validatebox" data-options="required:true, missingMessage:'请填写专题名称'" type="text" name="caahepTopic" style="border:0px;border-bottom: 1px solid black;"></input></td>
    </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="健教形式:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepHealtype" data-options="required:true, missingMessage:'请填写健教形式'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="健教地点:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepHealtlocation" data-options="required:true, missingMessage:'请填写健教地点'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="健教对象:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepHealobj" data-options="required:true, missingMessage:'请填写健教对象'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="最终目标:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepFinalobj" data-options="required:true, missingMessage:'请填写最终目标'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="计划年份:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahep" data-options="required:true, missingMessage:'请填写计划年份'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="执行日期:" ></input></td>
           <td colspan="1"><input class="easyui-datebox" name="caahepPlanyear" editable="fasle" data-options="required:true, missingMessage:'请填写执行日期'"   style="border:0px;border-bottom: 1px solid black;"></input></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="预计人数:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox " name="caahepPeonum" data-options="required:true, missingMessage:'请填写预计人数'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="预计经费:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepExfunds" data-options="required:true, missingMessage:'请填写预计经费'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="健教内容:" ></input></td>
           <td colspan="3"> <textarea  name="caahepHealcon"   style="width:100%;height:100px;border: 0px black solid"></textarea></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="健教问题:" ></input></td>
           <td colspan="3"> <textarea  name="caahepHealques"   style="width:100%;height:100px;border: 0px black solid"></textarea></td>
       </tr>
       <tr>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="计划制定人:" ></input></td>
           <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahepPlanner" data-options="required:true, missingMessage:'请填写计划制定人'" type="text"  style="border:0px;border-bottom: 1px solid black;"></input></td>
           <td colspan="1"><input type="text" class="tdText_h" readonly="ture"   value="制定日期:" ></input></td>
           <td colspan="1"><input class=" easyui-datebox" name="caahepPlandate" editable="fasle" data-options="required:true, missingMessage:'请填写制定日期'"   style="border:0px;border-bottom: 1px solid black;"></input></td>
       </tr>
   </table>
    </form>
</div>
<!-- 修改窗口 -->
<div id="edit-dialog" class="easyui-dialog" data-options="closed:true,iconCls:'icon-save'"
     style="width:450px; padding:10px;">
    <form id="edit-form" method="post">
    </form>
</div>
<input type="file" id="photo-file" style="display:none;" onchange="upload()">
<!--引入叫本页面<%@include file="../common/footer.jsp"%>-->
<div th:replace="common/footer :: myfooter"></div>


<!-- End of easyui-dialog -->
<script type="text/javascript" th:inline="none">

    /**
     *  添加记录
     */
    function add() {
        var validate = $("#add-form").form("validate");
        if (!validate) {
            $.messager.alert("消息提醒", "请检查你输入的数据!", "warning");
            return;
        }
        var data = $("#add-form").serialize();
        $.ajax({
            url: 'add',
            dataType: 'json',
            type: 'post',
            data: data,
            success: function (data) {
                if (data.type == 'success') {
                    $.messager.alert('信息提示', '添加成功！', 'info');
                    $('#add-dialog').dialog('close');
                    $('#data-datagrid').datagrid('reload');
                } else {
                    $.messager.alert('信息提示', data.msg, 'warning');
                }
            }
        });
    }

    /**
     * Name 修改记录
     */
    function edit() {
        var validate = $("#add-form").form("validate");
        if (!validate) {
            $.messager.alert("消息提醒", "请检查你输入的数据!", "warning");
            return;
        }
        var data = $("#add-form").serialize();
        $.ajax({
            url: 'edit',
            dataType: 'json',
            type: 'post',
            data: data,
            success: function (data) {
                if (data.type == 'success') {
                    $.messager.alert('信息提示', '修改成功！', 'info');
                    $('#add-dialog').dialog('close');
                    $('#data-datagrid').datagrid('reload');
                } else {
                    $.messager.alert('信息提示', data.msg, 'warning');
                }
            }
        });
    }

    /**
     * 删除记录
     */
    function remove() {
        $.messager.confirm('信息提示', '确定要删除该记录？', function (result) {
            if (result) {
                var item = $('#data-datagrid').datagrid('getSelections');
                if (item == null || item.length == 0) {
                    $.messager.alert('信息提示', '请选择要删除的数据！', 'info');
                    return;
                }
                var ids = '';
                for (var i = 0; i < item.length; i++) {
                    ids += item[i].caahepId + ',';
                }
                // alert(ids);
                $.ajax({
                    url: 'delete',
                    dataType: 'json',
                    type: 'post',
                    data: {ids: ids},
                    success: function (data) {
                        if (data.type == 'success') {
                            $.messager.alert('信息提示', '删除成功！', 'info');
                            $('#data-datagrid').datagrid('reload');
                        } else {
                            $.messager.alert('信息提示', data.msg, 'warning');
                        }
                    }
                });
            }
        });
    }

    /**
     * Name 打开添加窗口
     */
    function openAdd() {
        $('#add-form').form('reset');
        $('#add-dialog').dialog({
            closed: false,
            modal: true,
            title: "添加健教活动计划",
            buttons: [{
                text: '保存',
                iconCls: 'icon-ok',
                handler: add
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#add-form').form('reset');
                    $('#add-dialog').dialog('close');
                }
            }],
            onBeforeOpen: function () {
                //$("#add-form input").val('');
            }
        });
    }

    /**
     * 打开修改窗口
     */
    function openEdit() {
        //$('#edit-form').form('clear');
        var item = $('#data-datagrid').datagrid('getSelections');
        if (item == null || item.length == 0) {
            $.messager.alert('信息提示', '请选择要修改的数据！', 'info');
            return;
        }
        if (item.length > 1) {
            $.messager.alert('信息提示', '请选择一条数据进行修改！', 'info');
            return;
        }
        item = item[0];
        $('#add-dialog').dialog({
            closed: false,
            modal: true,
            title: "修改用户信息",
            buttons: [{
                text: '修改',
                iconCls: 'icon-ok',
                handler: edit
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#add-dialog').dialog('close');
                }
            }],
            onBeforeOpen: function () {
                $.ajax({
                    url: 'findById',
                    dataType: 'json',
                    type: 'post',
                    data: {id: item.caahepId},
                    success: function (data) {
                        if (data.type == 'success') {
                           $("#add-form").form('load',data.datainfo);
                           // $("#caahepId").val(item.caahepId);


                        } else {
                            $.messager.alert('信息提示', data.msg, 'warning');
                        }
                    }
                });
            }
        });
    }


    //搜索按钮监听
    $("#search-btn").click(function () {
        var caahepHealtype = $("#search-caahepHealtype").val();
        var option = {caahepTopic: $("#search-caahepTopic").val()};
        if (caahepHealtype !=null&&caahepHealtype !="") {
            option.caahepHealtype = caahepHealtype;
        }
        $('#data-datagrid').datagrid('reload', option);
    });

    /**
     * 载入数据
     */
    $('#data-datagrid').datagrid({
        url: 'list',
        rownumbers: true,
        singleSelect: false,
        pageSize: 20,
        pagination: true,
        multiSort: true,
        fitColumns: true,
        idField: 'caahepId',
        fit: true,
        columns: [[
            {field: 'chk', checkbox: true},
            {field: 'caahepId', title: '专题名称',hidden:true},
            {field: 'caahepTopic', title: '专题名称', width: 100},
            {field: 'caahepHealtype', title: '健教形式', width: 100, sortable: true},
            {field: 'caahepHealtlocation', title: '健教地点', width: 100},
            {field: 'caahepHealobj', title: '健教对象', width: 100},
            {field: 'caahepFinalobj', title: '最终目标', width: 100},
            {field: 'caahepPlanyear', title: '执行日期', width: 100,formatter:function(value,row,index){
                    return format(value);
                }},
            {field: 'caahepPeonum', title: '预计人数', width: 100},
            {field: 'caahepExfunds', title: '预计经费', width: 100},
            {field: 'caahepPlanner', title: '计划制定人', width: 100},
        ]]
    });
</script>