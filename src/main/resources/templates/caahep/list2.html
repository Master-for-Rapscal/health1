<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--引入抬头页面-->
<div th:replace="common/header :: header"></div>

<div class="easyui-layout" data-options="fit:true">
    <!-- Begin of toolbar -->
    <div id="wu-toolbar">
        <div class="wu-toolbar-button">
            <!--引入菜单页面-->
            <div th:replace="common/menus :: menus"></div>
        </div>
        <div class="wu-toolbar-search">
            <label>专题名称:</label><input id="search-caahepTopic" class="wu-text" style="width:100px">
            <label>健教形式:</label><input id="search-caahepHealtype" class="wu-text" style="width:100px">
            <a href="#" id="search-btn" class="easyui-linkbutton" iconCls="icon-search">搜索</a>
        </div>
    </div>
    <!-- End of toolbar -->
    <table id="data-datagrid" class="easyui-datagrid" toolbar="#wu-toolbar"></table>
</div>
<!-- Begin of easyui-dialog -->
<div id="add-dialog" class="easyui-dialog" data-options="closed:true,iconCls:'icon-save'"
     style="width:700px; padding:0px;">
    <div style="width: 100%; text-align: center"> <h3>健康教育活动记录表</h3></div>
    <form id="add-form" method="post">
        <input type="hidden" id="actrecordId" name="actrecordId" value="">
        <input type="hidden" name="actrecordState" value="1">
        <table class="zuo-table-head" border="1">
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动时间:"></input></td>
                <td colspan="1"><input class="easyui-datebox" name="caahepPlanyear" editable="fasle"
                                       data-options="required:true, missingMessage:'请填写执行日期'"
                                       style="border:0px;border-bottom: 1px solid black;"></input></td>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动地点:"></input></td>
                <td colspan="1"><input class="tdText_h easyui-validatebox" name="caahep"
                                       data-options="required:true, missingMessage:'请填写计划年份'" type="text"
                                       style="border:0px;border-bottom: 1px solid black;"></input></td>
            </tr>

            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动形式:"></input></td>
                <td colspan="3"><textarea name="caahepHealcon"
                                          style="width:100%;height:100px;border: 0px black solid"></textarea></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动主题:"></input></td>
                <td colspan="3"><textarea name="caahepHealcon"
                                          style="width:100%;height:100px;border: 0px black solid"></textarea></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="组织者:"></input></td>
                <td colspan="3"><input class="tdText_h " data-options="missingMessage:'请填写组织者'" type="text"
                                       name="caahepTopic" style="border:0px;border-bottom: 1px solid black;"></input></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="主讲人:"></input></td>
                <td colspan="3"><input class="tdText_h " data-options="missingMessage:'请填写组织者'" type="text"
                                       name="caahepTopic" style="border:0px;border-bottom: 1px solid black;"></input></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="健康教育人员类别:"></input></td>
                <td colspan="1"><input class="tdText_h " name="caahepHealtlocation" type="text" style="border:0px;border-bottom: 1px solid black;"></input></td>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="接受健康教育人数:"></input></td>
                <td colspan="1"><input class="tdText_h " name="caahepHealtlocation" type="text" style="border:0px;border-bottom: 1px solid black;"></input></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="健康教育资料发放种类:"></input></td>
                <td colspan="1"><input class="tdText_h " name="caahepHealtlocation" type="text" style="border:0px;border-bottom: 1px solid black;"></input></td>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="数量:"></input></td>
                <td colspan="1"><input class="tdText_h " name="caahepHealtlocation" type="text" style="border:0px;border-bottom: 1px solid black;"></input></td>
            </tr>

            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动内容:"></input></td>
                <td colspan="3"><textarea name="caahepHealcon"
                                          style="width:100%;height:100px;border: 0px black solid"></textarea></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="活动总结评价:"></input></td>
                <td colspan="3"><textarea name="caahepHealcon"
                                          style="width:100%;height:100px;border: 0px black solid"></textarea></td>
            </tr>
            <tr>
                <td colspan="1"><input type="text" class="tdText_h" readonly="ture" value="存档材料请附后:"></input></td>
                <td colspan="3">
                    <input type="checkbox" name="" onclick="checkItem1(this)" value="1">无
                    <input type="checkbox" name="" value="2">书面材料
                    <input type="checkbox" name=""  value="3">图片材料
                    <input type="checkbox" name=""  value="4">印刷材料
                    <input type="checkbox" name=""  value="5">影音材料
                    <input type="checkbox" name=""  value="6">签到表
                    <input type="checkbox" name=""  value="7">其他材料
                </td>
            </tr>
        </table>
        签表人(签字)：<input type="text" class="tdText_h" name="" value="">&nbsp;
        负责人(签字)：<input type="text" class="tdText_h" name="" value=""><br>
        填表时间：<input type="text" class="tdText_h" name="" value="">
    </form>
</div>

<!-- 引入 体检表格-->
<div id="healcheck-dialog" title='该计划所有的活动' class='easyui-dialog' data-options="closed:true"
     style="width:900px;height:600px;overflow:scroll; padding:0px; ">
    <table id="healcheckdata-datagrid" class="easyui-datagrid" ></table>

</div>


<!--引入叫本页面<%@include file="../common/footer.jsp"%>-->
<div th:replace="common/footer :: myfooter"></div>


<!-- End of easyui-dialog -->
<script type="text/javascript" th:inline="none">

    /**
     *  添加记录
     */
    function add() {
        var validate = $("#add-form").form("validate");
        if (!validate) {
            $.messager.alert("消息提醒", "请检查你输入的数据!", "warning");
            return;
        }
        var data = $("#add-form").serialize();
        $.ajax({
            url: 'add',
            dataType: 'json',
            type: 'post',
            data: data,
            success: function (data) {
                if (data.type == 'success') {
                    $.messager.alert('信息提示', '添加成功！', 'info');
                    $('#add-dialog').dialog('close');
                    $('#data-datagrid').datagrid('reload');
                } else {
                    $.messager.alert('信息提示', data.msg, 'warning');
                }
            }
        });
    }

    /**
     * Name 修改记录
     */
    function edit() {
        var validate = $("#add-form").form("validate");
        if (!validate) {
            $.messager.alert("消息提醒", "请检查你输入的数据!", "warning");
            return;
        }
        var data = $("#add-form").serialize();
        $.ajax({
            url: 'edit',
            dataType: 'json',
            type: 'post',
            data: data,
            success: function (data) {
                if (data.type == 'success') {
                    $.messager.alert('信息提示', '修改成功！', 'info');
                    $('#add-dialog').dialog('close');
                    $('#data-datagrid').datagrid('reload');
                } else {
                    $.messager.alert('信息提示', data.msg, 'warning');
                }
            }
        });
    }

    /**
     * 删除记录
     */
    function remove() {
        $.messager.confirm('信息提示', '确定要删除该记录？', function (result) {
            if (result) {
                var item = $('#data-datagrid').datagrid('getSelections');
                if (item == null || item.length == 0) {
                    $.messager.alert('信息提示', '请选择要删除的数据！', 'info');
                    return;
                }
                var ids = '';
                for (var i = 0; i < item.length; i++) {
                    ids += item[i].caahepId + ',';
                }
                // alert(ids);
                $.ajax({
                    url: 'delete',
                    dataType: 'json',
                    type: 'post',
                    data: {ids: ids},
                    success: function (data) {
                        if (data.type == 'success') {
                            $.messager.alert('信息提示', '删除成功！', 'info');
                            $('#data-datagrid').datagrid('reload');
                        } else {
                            $.messager.alert('信息提示', data.msg, 'warning');
                        }
                    }
                });
            }
        });
    }

    /**
     * Name 打开添加窗口
     */
    function openAdd() {
        $('#add-form').form('reset');
        $('#add-dialog').dialog({
            closed: false,
            modal: true,
            title: "添加健教活动计划",
            buttons: [{
                text: '保存',
                iconCls: 'icon-ok',
                handler: add
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#add-form').form('reset');
                    $('#add-dialog').dialog('close');
                }
            }],
            onBeforeOpen: function () {

            }
        });
    }

    /**
     * 打开修改窗口
     */
    function openEdit() {
        //$('#edit-form').form('clear');
        var item = $('#data-datagrid').datagrid('getSelections');
        if (item == null || item.length == 0) {
            $.messager.alert('信息提示', '请选择要修改的数据！', 'info');
            return;
        }
        if (item.length > 1) {
            $.messager.alert('信息提示', '请选择一条数据进行修改！', 'info');
            return;
        }
        item = item[0];
        $('#add-dialog').dialog({
            closed: false,
            modal: true,
            title: "修改用户信息",
            buttons: [{
                text: '修改',
                iconCls: 'icon-ok',
                handler: edit
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#add-dialog').dialog('close');
                }
            }],
            onBeforeOpen: function () {
                $.ajax({
                    url: 'findById',
                    dataType: 'json',
                    type: 'post',
                    data: {id: item.caahepId},
                    success: function (data) {
                        if (data.type == 'success') {
                            $("#add-form").form('load', data.datainfo);
                            // $("#caahepId").val(item.caahepId);


                        } else {
                            $.messager.alert('信息提示', data.msg, 'warning');
                        }
                    }
                });
            }
        });
    }


    //搜索按钮监听
    $("#search-btn").click(function () {
        var caahepHealtype = $("#search-caahepHealtype").val();
        var option = {caahepTopic: $("#search-caahepTopic").val()};
        if (caahepHealtype != null && caahepHealtype != "") {
            option.caahepHealtype = caahepHealtype;
        }
        $('#data-datagrid').datagrid('reload', option);
    });

    /**
     * 载入数据
     */
    $('#data-datagrid').datagrid({
        url: 'list',
        rownumbers: true,
        singleSelect: false,
        pageSize: 20,
        pagination: true,
        multiSort: true,
        fitColumns: true,
        idField: 'caahepId',
        fit: true,
        onDblClickRow:function(rowIndex, rowData){
            // $("#caahepId").val(rowData.caahepId);
            $("#healcheck-dialog").dialog({
                closed: false,
                modal: true,
                top:0,
                title: "该用户所有体检信息",
                buttons: [{
                    text: '新增',
                    iconCls: 'icon-ok',
                    handler: openAdd,
                },{
                    text: '修改',
                    iconCls: 'icon-ok',
                    handler: openEdit,
                },{
                    text: '删除',
                    iconCls: 'icon-ok',
                    handler: remove,
                },{
                    text: '取消',
                    iconCls: 'icon-cancel',
                    handler: function () {
                        $('#healcheck-dialog').dialog('close');
                    }
                }],
                onBeforeOpen: function () {
                    $('#healcheckdata-datagrid').datagrid({
                        url: 'list2?caahepId='+rowData.caahepId,
                        rownumbers: true,
                        singleSelect: true,
                        pageSize: 20,
                        pagination: true,
                        multiSort: true,
                        sortOrder:'desc',
                        sortName:'actrecordActtime',
                        fitColumns: true,
                        idField: 'actrecordId',
                        fit: true,
                        columns: [[
                            {field: 'chk', checkbox: true},
                            {field: 'actrecordId', title: '档案编号', width: 100,hidden:'true'},
                            {field: 'actrecordActtime  ', title: '活动时间', width: 100},
                            {field: 'actrecordVenue', title: '活动地点', width: 100},
                            {field: 'actrecordActtime  ', title: '组织者', width: 100},
                        ]]
                    });
                }

            });
            },
        columns: [[
            {field: 'chk', checkbox: true},
            {field: 'caahepId', title: '专题名称', hidden: true},
            {field: 'caahepTopic', title: '专题名称', width: 100},
            {field: 'caahepHealtype', title: '健教形式', width: 100, sortable: true},
            {field: 'caahepHealtlocation', title: '健教地点', width: 100},
            {field: 'caahepHealobj', title: '健教对象', width: 100},
            {field: 'caahepFinalobj', title: '最终目标', width: 100},
            {field: 'caahepPlanyear', title: '执行日期', width: 100, formatter: function (value, row, index) {return format(value);}},
            {field: 'caahepPeonum', title: '预计人数', width: 100},
            {field: 'caahepExfunds', title: '预计经费', width: 100},
            {field: 'caahepPlanner', title: '计划制定人', width: 100},
        ]]
    });
</script>